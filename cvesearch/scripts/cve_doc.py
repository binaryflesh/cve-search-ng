#!/usr/bin/env python3
# -*- coding: utf-8 -*-
#
# cve_doc converts CVE to asciidoc
#
# Software is free software released under the "GNU Affero General Public License v3.0"
#
# Copyright (c) 2015-2019  Alexandre Dulaunoy - a@foo.be
# Copyright (c) 2018-2019  Pieter-Jan Moreels - pieter-jan@pidgey.net

# Imports
import sys


from optparse import OptionParser

from cvesearch import Query, output

optp = OptionParser()
optp.add_option('-c', '--cve', dest='cve', default='CVE-2015-0001', help='CVE id to convert')
optp.add_option('-f', '--format', dest='format', default='asciidoc', choices=('asciidoc', 'csv', 'xml', 'json', 'html', 'cve-id', 'human'), help='output format : asciidoc')
optp.add_option('-a', '--api', dest='api', help='HTTP API url (default: http://cve.circl.lu)')
(opts, args) = optp.parse_args()

cve = Query(api=opts.api).cve(opts.cve.upper())
if not cve:
    print("CVE not found")
    sys.exit(10)

kwargs = {}
if opts.format.lower() == "html":
    kwargs['cveids'] = opts.cve.upper()

print(output(cve, opts.format.lower(), **kwargs))
