#!/usr/bin/env python3
# -*- coding: utf-8 -*-
#
# cve_doc converts CVE to asciidoc
#
# Software is free software released under the "GNU Affero General Public License v3.0"
#
# Copyright (c) 2015-2019  Alexandre Dulaunoy - a@foo.be
# Copyright (c) 2018-2019  Pieter-Jan Moreels - pieter-jan@pidgey.net

# Imports
import click
from cvesearch import Query, output


@click.command()
@click.argument('-c', '--cve', default='CVE-2015-0001', help='CVE id to convert')
@click.argument('-f', '--format', default='asciidoc', choices=['asciidoc', 'csv', 'xml', 'json', 'html', 'cve-id',
                                                             'human'], help='output format: asciidoc')
@click.argument('-a', '--api', default='http://cve.circl.lu', help='HTTP API url')
def cve_doc(cve, frmt, api):
    """Convert output to markup format."""
    __result = Query(api=api).cve(cve.upper())
    if not __result:
        raise IndexError('CVE not found.')
    kwargs = {}
    if frmt.lower() == 'html':
        kwargs['cveids'] = cve.upper()
    click.echo(output(cve, frmt.lower(), **kwargs))


if __name__ == '__main__':
    click.command(cve_doc)
